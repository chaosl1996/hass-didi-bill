
# æ»´æ»´è´¦å•é›†æˆ


ğŸ”– å®æ—¶åŒæ­¥æ»´æ»´å‡ºè¡Œæœˆåº¦æ¶ˆè´¹æ•°æ®åˆ°Home Assistant

## ğŸš€ åŠŸèƒ½ç‰¹æ€§
- å®æ—¶æ˜¾ç¤ºå½“æœˆæ»´æ»´å‡ºè¡Œæ€»æ¶ˆè´¹é‡‘é¢ï¼ˆç²¾ç¡®åˆ°åˆ†ï¼‰
- å±•ç¤ºè¡Œç¨‹æ¬¡æ•°ã€æ€»æ—¶é•¿ã€æ€»è·ç¦»ç­‰è¯¦ç»†æ•°æ®
- è‡ªåŠ¨æ›´æ–°è´¦å•æœˆä»½æ ‡è¯†
- æ”¯æŒè‡ªå®šä¹‰APIæ›´æ–°é—´éš”ï¼ˆ15-1440åˆ†é’Ÿï¼‰
- å¼‚å¸¸æ•°æ®è‡ªåŠ¨å›é€€æœºåˆ¶

## ğŸ“¦ å®‰è£…è¦æ±‚
- Home Assistant 2023.9 æˆ–æ›´é«˜ç‰ˆæœ¬
- Python 3.10+
- æœ‰æ•ˆçš„æ»´æ»´è´¦å•APIè®¿é—®æƒé™

## ğŸ”§ å®‰è£…é…ç½®
1. å°†æœ¬é›†æˆæ”¾å…¥`custom_components/didi_bill`ç›®å½•
2. é‡å¯Home AssistantæœåŠ¡
3. é€šè¿‡ã€é…ç½®ã€‘->ã€è®¾å¤‡ä¸æœåŠ¡ã€‘æ·»åŠ æ–°é›†æˆ
4. è¾“å…¥æœ‰æ•ˆçš„æ»´æ»´è´¦å•APIåœ°å€

## ğŸ”§ ç”µè„‘æŠ“åŒ…
> ç‚¹å‡»[æ»´æ»´è´¦å•URL]()è¿›å…¥æ»´æ»´è´¦å•;
> 
> 
> å¿«æ·é”®F12æˆ–è€…å³é”®é€‰æ‹©æ£€æŸ¥è¿›å…¥å¼€å‘äººå‘˜å·¥å…·ç•Œé¢ï¼›
> 
> ![GetImage.png](photo/GetImage.png)
> 
> è‡ªè¡Œç™»å½•å¼€å§‹æŠ“åŒ…; 
> 
> ![GetImage (1).png](photo/GetImage (1).png)
> 
> ç™»å½•æˆåŠŸå,æ‰¾åˆ°è´¦å•è¯·æ±‚.
> 
> å¦‚æœæ— æ³•æ‰¾åˆ°,å¯ä»¥å°è¯•åˆ·æ–°é¡µé¢.
> 
> ![GetImage (2).png](photo/GetImage (2).png)
> 
> è·å–è¯·æ±‚åœ°å€ï¼›
> 
> ![GetImage (3).png](photo/GetImage (3).png)
> 
> ä¸€èˆ¬æ¥è¯´,åœ¨æµè§ˆå™¨ä¸­è¾“å…¥è¯¥åœ°å€å°±ä¼šå¾—åˆ°å¯¹åº”çš„å“åº”jsonæ–‡ä»¶.å¯ä½¿ç”¨è¯¥æ“ä½œåˆ¤æ–­urlæ˜¯å¦å¤±æ•ˆ.
> 
> å¦‚ä¸‹å›¾:
> 
> ![GetImage (4).png](photo/GetImage (4).png)
>

## âš™ï¸ é…ç½®å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|-----|
| `api_url` | string | æ˜¯ | æ—  | æ•°æ®æ¥å£åœ°å€ï¼ˆéœ€HTTPSï¼‰ |
| `update_interval` | integer | å¦ | 30 | åˆ·æ–°é¢‘ç‡ï¼ˆåˆ†é’Ÿï¼‰ |

## ğŸ“Š å®ä½“å±æ€§
```yaml
# ä¸»è¦çŠ¶æ€å€¼
state: 158.50  # å½“æœˆæ¶ˆè´¹é‡‘é¢ï¼ˆå•ä½ï¼šå…ƒï¼‰

# æ‰©å±•å±æ€§ï¼ˆextra_state_attributesï¼‰
count: 12       # å½“æœˆè¡Œç¨‹æ¬¡æ•°
time: 460       # æ€»è¡Œç¨‹æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
distance: 68.4  # æ€»è¡Œç¨‹è·ç¦»ï¼ˆå…¬é‡Œï¼‰
month: "2024-01" # è´¦å•æœˆä»½
unit_of_measurement: "CNY" # è®¡é‡å•ä½
```

## ğŸ› ï¸ é«˜çº§é…ç½®
é€šè¿‡`configuration.yaml`è®¾ç½®å…¨å±€é»˜è®¤å€¼ï¼š
```yaml
didi_bill:
  api_url: https://api.didi.com/v3/bills
  update_interval: 60
```

## â“ å¸¸è§é—®é¢˜
### æ•°æ®ä¸æ›´æ–°
âœ… æ£€æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤APIè¿”å›JSONåŒ…å«ä»¥ä¸‹ç»“æ„ï¼š
```json
{
  "data": {
    "travel_cost": 15850,
    "travel_count": 12,
    "charge_duration": 460,
    "travel_distance": 68400,
    "title": "{2024-01}"
  }
}
```
2. æ£€æŸ¥é›†æˆæ—¥å¿—ï¼š`homeassistant.components.didi_bill`
3. éªŒè¯ç½‘ç»œè¿é€šæ€§ï¼š`telnet api.didi.com 443`

### å±æ€§æ˜¾ç¤ºä¸å…¨
âœ… ç¡®ä¿ï¼š
- APIå“åº”åŒ…å«å®Œæ•´å­—æ®µ
- é›†æˆç‰ˆæœ¬ â‰¥ 1.1.0
- å·²æˆäºˆ`homeassistant`ç”¨æˆ·è¯»å–æƒé™

## ğŸ“„ å¼€å‘æ–‡æ¡£
```python
class DiDiBillSensor(CoordinatorEntity, Entity):
    """æ»´æ»´è´¦å•ä¼ æ„Ÿå™¨å®ä½“

    å±æ€§:
    - coordinator: æ•°æ®åè°ƒå™¨å®ä¾‹
    - entry: é…ç½®æ¡ç›®å¯¹è±¡
    """

    def __init__(self, coordinator, entry):
        super().__init__(coordinator)
        self._attr_unique_id = f"didi_bill_{entry.entry_id}"
        # ...å…¶ä»–åˆå§‹åŒ–é€»è¾‘...
```

## ğŸ“œ è®¸å¯è¯
MIT License - [æŸ¥çœ‹å®Œæ•´åè®®](LICENSE)
